var y=Object.defineProperty;var C=(s,t,e)=>t in s?y(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var h=(s,t,e)=>C(s,typeof t!="symbol"?t+"":t,e);import{r as d,g as $,s as I,c as l,o as c,a as o,t as p,w as g,v as f,F as b,b as L,d as O,h as _,i as m,n as S,e as N}from"./myPopup-C2-QI-lh.js";class v{constructor(t){h(this,"stock",d({}));h(this,"cart",d({}));h(this,"lastSku",d(""));h(this,"namesSearch",d({}));h(this,"emptyCart",{productSku:{},skuList:[],total:0});this.cartSessionStorage="mercado-solidario-cart-"+t,this.stockSessionStorage="mercado-solidario-stock",this.loadStockRef(),this.loadCartRef()}async loadStockRef(){const t=sessionStorage.getItem(this.stockSessionStorage);if(t!=null)this.stock.value=JSON.parse(t);else{const e=await $("/stock");e.status==200?(this.stock.value=e.data,sessionStorage.setItem(this.stockSessionStorage,JSON.stringify(e.data))):I("Erro","Não foi possível buscar os produtos")}}loadCartRef(){const t=localStorage.getItem(this.cartSessionStorage);this.cart.value=t==null?structuredClone(this.emptyCart):JSON.parse(t)}clearCart(){this.cart.value=structuredClone(this.emptyCart),localStorage.removeItem(this.cartSessionStorage)}saveCartLocalStorage(){localStorage.setItem(this.cartSessionStorage,JSON.stringify(this.cart.value))}addSkuList(t){if(!this.stock.value[t])return null;this.delSkuList(t),this.cart.value.skuList.unshift(t)}delSkuList(t){this.cart.value.skuList=this.cart.value.skuList.filter(e=>e!=t)}addProd(t){const e=this.stock.value[t];if(!e)return null;const a={id:e.id,name:e.name,price:e.price,quantity:1},n=this.cart.value.productSku[t];n?n.quantity=this.getQuantity(t)+1:this.cart.value.productSku[t]=a,this.lastSku.value=t,this.addSkuList(t),this.updateCartTotal()}subProd(t){const e=this.cart.value.productSku[t];if(!e)return null;if(this.getQuantity(t)>1)e.quantity=this.getQuantity(t)-1;else return this.delProd(t),null;this.updateCartTotal()}delProd(t){if(!this.cart.value.productSku[t])return null;delete this.cart.value.productSku[t],this.delSkuList(t),this.updateCartTotal()}getQuantity(t){const e=this.cart.value.productSku[t];return e?Number(e.quantity):null}setQuantity(t,e){const a=this.cart.value.productSku[t];if(!a)return null;switch(typeof e){case"string":const n=e.replace(/[^0-9]/g,"");a.quantity=n==""?"":Number(n);break;case"number":a.quantity=e;break;default:return null}this.updateCartTotal()}updateCartTotal(){let t=0;for(let e in this.cart.value.productSku){const a=this.cart.value.productSku[e];t+=this.getQuantity(e)*a.price}this.cart.value.total=t,this.saveCartLocalStorage()}getCart(){if(this.cart.value.total==0)return null;const t=[];for(let e in this.cart.value.productSku){const a=this.cart.value.productSku[e];this.getQuantity(e)>0&&t.push({sku:e,...a})}return t}searchName(t){this.clearNamesSearch();const e=new RegExp(t,"i");Object.keys(this.stock.value).forEach(a=>{const n=this.stock.value[a];n.name.match(e)&&(this.namesSearch.value[a]=n)})}clearNamesSearch(){this.namesSearch.value={}}}const k=(s,t)=>{const e=s.__vccOpts||s;for(const[a,n]of t)e[a]=n;return e},P={class:"del"},x={__name:"Product",props:{sku:String,product:Object,stockObj:v},setup(s){const t=s;function e(r){t.stockObj.setQuantity(t.sku,r.target.value)}function a(r){const u=t.stockObj.getQuantity(r)+1;t.stockObj.setQuantity(r,u)}function n(r){const u=t.stockObj.getQuantity(r)-1;u<1?t.stockObj.delProd(r):t.stockObj.setQuantity(r,u)}return(r,u)=>(c(),l(b,null,[o("td",null,p(s.product.name),1),o("td",null,"R$ "+p(s.product.price),1),o("td",null,[g(o("input",{"onUpdate:modelValue":u[0]||(u[0]=i=>s.product.quantity=i),onInput:e},null,544),[[f,s.product.quantity]])]),o("td",null,[o("button",{class:"submitButton borderRound medium",onClick:u[1]||(u[1]=i=>a(s.sku))},"+")]),o("td",null,[o("button",{class:"submitButton borderRound medium",onClick:u[2]||(u[2]=i=>n(s.sku))},"-")]),o("td",P,[o("button",{class:"submitButton borderRound",onClick:u[3]||(u[3]=i=>s.stockObj.delProd(s.sku))},"Delete")])],64))}},B=k(x,[["__scopeId","data-v-92fda1d6"]]),Q={class:"searchBox"},R={key:0},q=["onClick"],w={__name:"SearchName",props:{stockObj:v},setup(s){const t=s,e=d("");function a(r){r.target.value.length>2?t.stockObj.searchName(r.target.value):t.stockObj.clearNamesSearch()}function n(r){t.stockObj.addProd(r),t.stockObj.clearNamesSearch(),e.value=""}return(r,u)=>(c(),l("div",Q,[g(o("input",{"onUpdate:modelValue":u[0]||(u[0]=i=>e.value=i),onInput:a},null,544),[[f,e.value]]),e.value?(c(),l("ul",R,[(c(!0),l(b,null,O(s.stockObj.namesSearch.value,(i,j)=>(c(),l("li",null,[o("span",{onClick:st=>n(j)},p(s.stockObj.namesSearch.value[j].name),9,q)]))),256))])):L("",!0)]))}},T=k(w,[["__scopeId","data-v-4cb9ef01"]]),V={class:"searchBox"},E={__name:"SearchSku",props:{stockObj:v},setup(s){const t=s,e=d("");function a(n){t.stockObj.addProd(n.target.value),e.value=""}return(n,r)=>(c(),l("div",V,[g(o("input",{"onUpdate:modelValue":r[0]||(r[0]=u=>e.value=u),onKeyup:_(a,["enter"])},null,544),[[f,e.value]])]))}},J=k(E,[["__scopeId","data-v-bc02826e"]]),U={class:"searchBar"},D={class:"searchInput"},K={class:"searchToggle"},F={__name:"SearchProd",props:{stockObj:v},setup(s){const t=d("nome");return(e,a)=>(c(),l("div",U,[o("div",D,[t.value==="sku"?(c(),m(J,{key:0,stockObj:s.stockObj},null,8,["stockObj"])):(c(),m(T,{key:1,stockObj:s.stockObj},null,8,["stockObj"]))]),o("div",K,[o("span",{class:S({active:t.value==="sku"}),onClick:a[0]||(a[0]=n=>t.value="sku")}," SKU ",2),o("span",{class:S({active:t.value==="nome"}),onClick:a[1]||(a[1]=n=>t.value="nome")}," Nome ",2)])]))}},M=k(F,[["__scopeId","data-v-96b7ab71"]]),z={class:"divSubpage blackPage borderRound"},A={class:"del"},G={__name:"CartList",props:{stockObj:v},setup(s){return(t,e)=>(c(),l("div",z,[N(M,{stockObj:s.stockObj},null,8,["stockObj"]),o("p",null,"Total: $"+p(s.stockObj.cart.value.total),1),o("button",{class:"submitButton borderRound",onClick:e[0]||(e[0]=a=>t.$emit("send"))},"Enviar"),o("table",null,[o("thead",null,[e[2]||(e[2]=o("th",{class:"produto"},"Produto",-1)),e[3]||(e[3]=o("th",{class:"preco"},"Preço",-1)),e[4]||(e[4]=o("th",{class:"quantidade"},"Qtd.",-1)),e[5]||(e[5]=o("th",{class:"add"},null,-1)),e[6]||(e[6]=o("th",{class:"sub"},null,-1)),o("th",A,[o("button",{class:"submitButton borderRound",onClick:e[1]||(e[1]=a=>s.stockObj.clearCart())},"Limpar carrinho")])]),o("tbody",null,[(c(!0),l(b,null,O(s.stockObj.cart.value.skuList,a=>(c(),l("tr",null,[(c(),m(B,{key:a,sku:a,product:s.stockObj.cart.value.productSku[a],stockObj:s.stockObj},null,8,["sku","product","stockObj"]))]))),256))])])]))}},nt=k(G,[["__scopeId","data-v-2fceb1e7"]]),H={class:"divSubpage blackPage borderRound stock"},W=["onClick"],X=["src"],Y={__name:"StockList",props:{stockObj:v},setup(s){return(t,e)=>(c(),l("div",H,[(c(!0),l(b,null,O(s.stockObj.stock.value,(a,n)=>(c(),l("div",null,[(c(),l("div",{key:n,class:"prodImg",onClick:r=>s.stockObj.addProd(n)},[o("img",{src:a.image,class:S({selected:s.stockObj.lastSku.value==n,borderRound:!0}),width:"100px",height:"100px"},null,10,X),o("p",null,p(a.name),1)],8,W))]))),256))]))}},rt=k(Y,[["__scopeId","data-v-40559dd2"]]),Z={},tt={class:"loading-spinner"};function et(s,t){return c(),l("div",tt,[...t[0]||(t[0]=[o("div",{class:"spinner-ring"},null,-1)])])}const ut=k(Z,[["render",et],["__scopeId","data-v-0562744c"]]);export{nt as C,ut as L,rt as S,k as _,v as s};
